<!DOCTYPE html>

<html>
    <head>
        <title>BASIC | FLOWDOCODE</title>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <link rel="stylesheet" type="text/css" media="screen" href="../css/bootstrap.min.css" />
        <link rel="stylesheet" type="text/css" media="screen" href="../css/jquery-ui.min.css" />
        <link rel="stylesheet" type="text/css" media="screen" href="../css/main.css" />
        <script src="../js/jquery.js"></script>
        <script src="../js/jquery-ui.min.js"></script>
        <script src="../js/bootstrap.min.js"></script>
        <script src="../js/flowdocode.js"></script>



    </head>
    <style>
   
    </style>
    <body>
      
    <nav class="navbar navbar-expand-lg navbar-light bg-light">
  <div class="collapse navbar-collapse" id="navbarNavDropdown">
    <ul class="navbar-nav">
        <li class="nav-item">
            <a class="nav-link "href="Basic.html">Basic</a>
          </li>
      <li class="nav-item">
        <a class="nav-link "href="Decision.html">Decision</a>
      </li>
      <li class="nav-item">
        <a class="nav-link "href="Loop.html">Loop</a>
      </li>
     
    </ul>
  </div>
 

  
</nav>

      <div class="col-2 con-fixed h-100 pb-5" >
              <div class="my-5  toolbox start-end " id="start-end"draggable="true" ondragstart="drag(event)" >
                <svg   >
                  <path d="M 25 1 C -5,1 -5,49 25,49 L 120 49 C 155,49 155,0 120,1 Z"/>                
                </svg>
                <div class="text text-center col-7  text-truncate mx-auto" >
                  End
                </div>
              </div>
              <div class="my-5 toolbox process" id="process"draggable="true" ondragstart="drag(event)">
                <svg                     >
                  <path d="M 1 1 L 149 1 L 149 49 L 1 49 Z"/>
                </svg>
                <div class="text text-center col-7  text-truncate mx-auto"  >
                  Process
                </div>
              </div>
              <div class="my-5  toolbox input"id="input" draggable="true"ondragstart="drag(event)" >
                <svg >
                  <path d="M 1 15 L 149 1 L 149 49 L 1 49 Z"/>
                </svg >
                <div class="text text-center col-7  text-truncate mx-auto"  >
                  Input
                </div>
              </div>
              <div class="my-5  toolbox decision"id="decision" draggable="true"ondragstart="drag(event)" >
                <svg   >
                  <path d="M 75 0 L 150 25 L 75 50 L 0 25 Z "/>
                </svg>
                <div class="text text-center  col-7 text-truncate mx-auto"  >
                  Decision
                </div>
              </div>
              <div class="my-5 toolbox display"id="display" draggable="true"ondragstart="drag(event)">
                <svg   >
                  <path d="M 1 25 L 15 49 H 120 C 155 49 ,155 1, 120 1 H 15 L 1,25  "/>
                </svg>
                <div class="text text-center col-7  text-truncate mx-auto"  >
                  Display
                </div>
              </div>
              <div class="my-5 toolbox connect"id="connect" >
                <svg  stroke="red" fill="none" >
                  <circle cx="50" cy="50" r="45"   />            
                </svg>
                <div class="text text-center col-4 p-0   text-truncate mx-auto"  >
                  Connect
                </div>
              </div>
              
     
      </div>
      
      <div class="offset-2 col-8 py-5 con-fixed h-75 " id="content"ondragover="allowDrop(event)"ondrop="dropItem(event)">
        
        <div class="toolbox shape start-end " id="start"  >
          <svg   >

            <path d="M 25 1 C -5,1 -5,49 25,49 L 175 49 C 200,49 200,1 175,1 Z"/>                
          </svg>
          <div class="text text-center col-8  text-truncate mx-auto" >
            Start
          </div>
        </div>
       
       
      </div>

      <div class="col-8 con-fixed h-25 offset-2 fixed-bottom"id="console" style="background: #fff;">Console</div>                                          
  
      <div class="offset-10 col-2  con-fixed h-100" >
        <button>Compile</button>
      </div>


 

    </body>


    <script>
      var selectedEl=undefined;
      $(function(){
        $(".toolbox").each(function (){
          updateTextboxPosition($(this),10);
        });
        $(".shape").each(function (){
          updateTextboxPosition($(this),15);
        });
        let p={
          top:87,
          left:550
        }
        $("#start").offset(p);
        $(".shape").draggable();
          
        
  
      });  
  
  function allowDrop(event) {
    event.preventDefault();
  }
  function drag(ev) {
  
  // ev.dataTransfer.setData("text", ev.target.getAttribute('data-type'));
  ev.dataTransfer.setData("text", ev.target.id);
  
  
  }
  function dropItem(event){
  
  
    event.preventDefault();
    var type=event.dataTransfer.getData("text");
   
  
    if(type!=null){
       
       if($("#content").find("."+type+"").last().index()==-1){
         var index=0;
       }else{
         var str= $("#content").find("."+type+"").last().prop("id");
         str=str.split("-");
       
          var index=str[str.length-1];
          index++;
       }
  
     
  
       
        var attrObj={
          id:(type+"-"+index),
        
        }
       
        let mousePoint={
          left: event.clientX-100 ,
          top: event.clientY-25
        }
        let node=$("template#"+type).html();
         
        node=$(node).draggable();
        node=$(node).resizable({handles: "e,  w",resize:function(){
                updateSvgPath(node,type);
                
        }});
       

        $("#content").append(node);
       
        $(node).offset(mousePoint);
        $(node).prop(attrObj);  
        updateTextboxPosition(node,0);
    
        
       
  
        
  
  
        
    }
      
     
  }
  $("div").on("click",".shape",function(){
      if($(selectedEl).prop("id")!=$(this).prop("id")){
        shapeUnSelectedStyle();
      }
        selectedEl=$(this);
      shapeSelectedStyle();
      $(document).keydown(function(event){
        if((event.keyCode==8||event.keyCode==46)&&$(selectedEl).find("div.text").prop("contenteditable")!="true"){
          $(selectedEl).remove();
        }
        if(event.keyCode==13){
          disContentEdit();
        }
      });
    
      
     
      $("div").on("click",".text",function(){
        if(!$(selectedEl).hasClass("start-end")){
          document.body.style.cursor="";
          $(selectedEl).find("div.text").prop("contenteditable",true);
          $(selectedEl).draggable({ disabled: true });
        }
        
      });
      $("div").on("blur",".text",function(){

          disContentEdit();
        console.log($(selectedEl).prop("contenteditable"));
        
      });

    

    
  });
  
 
  $("#content").on("mouseup",function(event){
    if(event.target === this){
      shapeUnSelectedStyle();

    }
     
  });
  

  $(document).on("mouseenter",".shape",function(){
    document.body.style.cursor="grab";
  });
  $(document).on("mouseleave",".shape",function(){
    document.body.style.cursor="";
  });


  $(document).on("mouseup",".shape",function(){
    shapeSelectedStyle();
    document.body.style.cursor="grab";
  });
  
  function shapeSelectedStyle(){
    try {
      selectedEl.find("svg").css({
        "stroke-dasharray":"5,5"
      });
    } catch (error) {
  
  
    }


  
  
  }
  function shapeUnSelectedStyle(){
    try {

      selectedEl.find("svg").css({
        "stroke-dasharray":"0,0"
      });
  
    } catch (error) {
  
  
    }finally{
      disContentEdit();
      selectedEl=undefined;
  
    }
    
  
   
  
  }
  function disContentEdit(){
  
  $(selectedEl).find(".text").prop("contenteditable","false");
  $(selectedEl).draggable({ disabled: false });
  document.body.style.cursor="";
  }
  
  
  

  
  
  
      </script> 
  <scrip type="text/template">

    <template id="start-end">
      <div class="shape start-end " >
          <svg>
              <path d="M 25 1 C -5,1 -5,49 25,49 L 175 49 C 200,49 200,1 175,1 Z"/>                
          </svg>
          <div class="text text-center col-12  text-truncate mx-auto "   >
            End
          </div>
      </div>
    </template> 
    <template id="process">
        <div class="shape process ">
            <svg   >
              <path d="M 1 1 L 199 1 L 199 49 L 1 49 Z"/>
            </svg>
            <div class="text text-center col-12  text-truncate mx-auto"contenteditable=false  >
              Process
            </div>
        </div>
    </template>
    <template id="input">
        <div class="shape input" >
          <svg   >
            <path d="M 1 15 L 199 1 L 199 49 L 1 49 Z"/>
          </svg>
          <div class="text text-center col-12  text-truncate mx-auto"contenteditable=false  >
                  Input
          </div>
        </div>
    </template>   
    <template id="decision">
        <div class=" shape decision " >
          <svg>
            <path d="M 100 1 L 199 25 L 100 49 L 1 25 Z "/>
          </svg>
          <div class="text text-center col-12  text-truncate mx-auto"contenteditable="false"  >
            Decision
          </div>
        </div>
    </template>
    <template id="display">
      <div class=" shape display " >
        <svg>
          <path d="M 1 25 L 15 49 H 180 C 205 49 ,205 1, 180 1 H 15 L 1,25  "/>
        </svg>
        <div class="text text-center col-12  text-truncate mx-auto"contenteditable="false"  >
          Display
        </div>
      </div>
  </template>
</template>
<template id="connect">
  <div class="shape connect " >
    <svg>
      <circle cx="50" cy="50" r="45"   />            
    </svg>
    <div class="text text-center col-6  text-truncate mx-auto" contenteditable="false" >
      Connect
    </div>
  </div>
</template>




  </scrip>
</html>


