<!DOCTYPE html>

<html>

<head>
  <title>FlowdoCode | FLOWDOCODE</title>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" type="text/css" media="screen" href="css/bootstrap.min.css" />
  <link rel="stylesheet" type="text/css" media="screen" href="css/jquery-ui.min.css" />
  <link rel="stylesheet" type="text/css" media="screen" href="css/font-awesome-all.min.css" />
  <link rel="stylesheet" type="text/css" media="screen" href="css/main.css" />
       
       

  <script src="js/jquery.js"></script>
  <script src="js/jquery-ui.min.js"></script>
  <script src="js/bootstrap.min.js"></script>
  <script src="js/flowdocode.js"></script>
  <script src="js/compiler.js"></script>
  <script src="js/font-awesome-all.min.js"></script>



</head>

<body>

  <nav class="navbar navbar-expand-lg navbar-light bg-light p-0">
      <div class="col-6">
          <ul class="navbar-nav" >
              <li class="nav-item">
                <a class="nav-link " >File</a>
              </li>
              <li class="nav-item">
                <a class="nav-link " >Edit</a>
              </li>
              <li class="nav-item">
                <a class="nav-link ">Help</a>
              </li>
            
          </ul>
      </div>
      <div class="col-6 py-2 m-0">
          <ul class="navbar-nav  m-0" >
              <li class="nav-item ">
                  <button class="btn btn-sm btn-flowdocode"><i class="fas fa-play"></i></button>
              </li>
          </ul>
      </div>

    
     



  </nav>
  <svg id="canvas">
    <defs>
      <marker id="arrowhead" viewBox="0 0 10 10" refX="10" refY="5" markerWidth="6" markerHeight="6" orient="auto">
        <path d="M 0 0 L 10 5 L 0 10 z" fill="#fff" />
      </marker>
    </defs>



  </svg>
  <div class="col-2 con-fixed h-100 pb-5">
    <div class="my-5  toolbox start-end " id="start-end" draggable="true" ondragstart="drag(event)">
      <svg >
        <path d="M 25 1 C -5,1 -5,49 25,49 L 120 49 C 155,49 155,0 120,1 Z" />
      </svg>
      <!-- <div class="text text-center col-7  text-truncate mx-auto" >
                  End
                </div> -->
    </div>
    <div class="my-5 toolbox process" id="process" draggable="true" ondragstart="drag(event)">
      <svg>
        <path d="M 1 1 L 149 1 L 149 49 L 1 49 Z" />
      </svg>
      <!-- <div class="text text-center col-7  text-truncate mx-auto"  >
                  Process
                </div> -->
    </div>
    <div class="my-5  toolbox input" id="input" draggable="true" ondragstart="drag(event)">
      <svg>
        <path d="M 1 15 L 149 1 L 149 49 L 1 49 Z" />
      </svg>
      <!-- <div class="text text-center col-7  text-truncate mx-auto"  >
                  Input
                </div> -->
    </div>
    <div class="my-5  toolbox decision" id="decision" draggable="true" ondragstart="drag(event)">
      <svg>
        <path d="M 75 1 L 150 25 L 75 50 L 1 25 Z " />
      </svg>
      <!-- <div class="text text-center  col-7 text-truncate mx-auto"  >
                  Decision
                </div> -->
    </div>
    <div class="my-5 toolbox display" id="display" draggable="true" ondragstart="drag(event)">
      <svg>
        <path d="M 1 25 L 15 49 H 120 C 155 49 ,155 1, 120 1 H 15 L 1,25  " />
      </svg>
      <!-- <div class="text text-center col-7  text-truncate mx-auto"  >
                  Display
                </div> -->
    </div>


  </div>

  <div class="offset-2 col-8 py-0 con-fixed con-content h-75 "  ondragover="allowDrop(event)" ondrop="dropItem(event)">
    <div id="content">
        <div class="shape input " id="input-0"
            style="position: relative; top: 137px; left: 135.344px;">
            <div class="con_anchor anchor_top ui-draggable ui-draggable-handle ui-droppable" data-point="top"
                style="top: -4px; left: 96px;"></div>
            <div class="con_anchor anchor_right ui-draggable ui-draggable-handle ui-droppable" data-point="right"
                style="top: 21px; left: 195px;"></div>
            <div class="con_anchor anchor_bottom ui-draggable ui-draggable-handle ui-droppable" data-point="bottom"
                style="top: 46px; left: 96px;"></div>
            <div class="con_anchor anchor_left ui-draggable ui-draggable-handle ui-droppable" data-point="left"
                style="top: 21px; left: -3px;"></div>
            <svg>
                <path d="M 1 15 L 199 1 L 199 49 L 1 49 Z"></path>
            </svg>
            <div class="text text-center col-12  text-truncate mx-auto" contenteditable="false" style="top: 10px; left: 0px;">
                Input
            </div>
            <div class="ui-resizable-handle ui-resizable-w" style="z-index: 90;"></div>


  
  
  </div>

  <div class="col-8 con-fixed h-25 p-3 offset-2 fixed-bottom " id="console" style="background: #fff;">
    
  </div>

  <div class="offset-10 col-2  con-fixed h-100">
  </div>




</body>


<script>

  $(function () {

    $(".shape").each(function () {
      $(this).find(".con_anchor").draggable(conAnchorDraggableProperty());
      $(this).find(".con_anchor").droppable(conAnchorDroppableProperty());
      $(this).draggable(nodeDraggableProperty());
      $(this).resizable(nodeResizableProperty("input"));
      updateAnchorPosition($(this));
      updateTextboxPosition($(this));
    });
    let p = {
      top: 87,
      left: 550
    }
    $("#start").offset(p);
    $(".shape").draggable();



  });

  function allowDrop(event) {
    event.preventDefault();
  }
  function drag(ev) {

    // ev.dataTransfer.setData("text", ev.target.getAttribute('data-type'));
    ev.dataTransfer.setData("text", ev.target.id);


  }  
  function dropItem(event) {


    event.preventDefault();
    try {

      var type = event.dataTransfer.getData("text");
      onDropItemSuccess(type);
      console.log($("#content").html());
    } catch (event) {
      var type = "";
    }






  }
  


  $("div").on("click", ".shape", function () {
    if ($(selectedEl).prop("id") != $(this).prop("id")) {
      shapeUnSelectedStyle();
    }
    selectedEl = $(this);

    shapeSelectedStyle();
    $(document).keydown(function (event) {

      if ((event.keyCode == 8 || event.keyCode == 46) && $(selectedEl).find("div.text").prop("contenteditable") != "true") {
        if ($(selectedEl).prop("id") != "start"){
          $(selectedEl).remove();
          checkConnectorOnNodeDelete(selectedEl);
        }
      }
      if (event.keyCode == 13) {
        disContentEdit();
        shapeUnSelectedStyle();
      }
    });



    $("div").on("dblclick", ".text", function () {
      if (!$(selectedEl).hasClass("start-end")) {
        document.body.style.cursor = "";
        $(selectedEl).find("div.text").prop("contenteditable", true);
        $(selectedEl).draggable({ disabled: true });

      }

    });
    $("div").on("blur", ".text", function () {

      disContentEdit();

    });




  });


  $("#content").on("mouseup", function (event) {
    if (event.target === this) {
      shapeUnSelectedStyle();

    }

  });


  $(document).on("mouseenter", ".shape", function () {
    document.body.style.cursor = "grab";
    if($(selectedEl).prop("id") != $(this).prop("id")){
      $(this).find(".con_anchor").css("opacity", "1");
      $(document).on("mousedown", function () {
        mouseDown = true;
     

      });
    }
 });
  $(document).on("mouseleave", ".shape", function () {
    document.body.style.cursor = "";
    if (!mouseDown) {
      $(this).find(".con_anchor").css("opacity", "0");
    }
    $(document).on("mouseup", function () {
      mouseDown = false;
    });
  });


  $(document).on("mouseup", ".shape", function () {
    if (selectedEl == undefined) {
      selectedEl = $(this);

    }
    shapeSelectedStyle();
    document.body.style.cursor = "grab";
  });

  $(document).on("mousedown", ".con_anchor", function () {

      originalPosition = $(this).offset();
      g = document.createElementNS("http://www.w3.org/2000/svg", "g");
      g = $(g).attr("marker-end", "url(#arrowhead)");
      g = $(g).attr("stroke-width", "2");

      $("#canvas").append($(g));

  });


  $(".con-content").on("scroll",function(){
    $("line").each(function () {
          updateConnectorPosition($(this));

    });
  });










</script>


</html>